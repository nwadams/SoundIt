{% extends "base.html" %}

{% block title %}SoundIT Venue| Currently Playing{% endblock %}

{% block content %}
	<div class="audio-box">
		<audio id="player" controls height="100" width="100">
		  	<source src="/static/backend/donomar.m4a" type="audio/mpeg">
		  	<source src="horse.ogg" type="audio/ogg">
		  	<embed height="50" width="100" src="">
		</audio>
	</div>
	<div class="box">
		<span class="fs-xl">CURRENT PLAYLIST</span>
		<div id="playlist-flipbox" class="current-playlist-box m-basic-t">
			<div id="playlist-flipbox-data">
			{% if playlist_item_list %}
			    {% for item in playlist_item_list %}
			    	<div class="o-h {% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
			    		<div class="playlist-item-art">
			    			{% if item.music_track.album.image_URL %}
			    				{% with url=item.music_track.album.image_URL %}
			    					<img width="100" height="100" src="{{url}}">
			    				{% endwith %}
		    				{% else %}
		    					{% with url="http://api.soundit.ca/static/venue/soundit_logo_small.png" %}
		    						<img width="100" height="100" src="{{url}}">
		    					{% endwith %}
	    					{% endif %}
			    		</div>
			    		<div class="playlist-item-data fs-m">
			    			<ul>
			    				<li class="p-small-t">{{item.music_track.name}}</li>
			    				<li class="p-small-t">{{item.music_track.album.name}}</li>
			    				<li class="p-small-t">{{item.music_track.artist.name}}</li>
			    			</ul>
			    		</div>
			    		<div class="playlist-item-votes">
			    			10
			    		</div>
			    	</div>
			    {% endfor %}
			{% else %}
			    <p>No items currently in playlist.</p>
			{% endif %}
			</div>
		</div>
		<div id="library-flipbox" class="library-box m-basic-t">
			<div id="library-flipbox-data" class="dn">
				{% if music_track_list %}
				{% for track in music_track_list %}
					<div class="o-h {% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
						<div class="playlist-item-art">
							{% if track.album.image_URL %}
			    				{% with url=item.music_track.album.image_URL %}
			    					<img width="100" height="100" src="{{url}}">
			    				{% endwith %}
		    				{% else %}
		    					{% with url="http://api.soundit.ca/static/venue/soundit_logo_small.png" %}
		    						<img width="100" height="100" src="{{url}}">
		    					{% endwith %}
	    					{% endif %}
						</div>
						<div class="playlist-item-data fs-m">
							<ul>
								<li class="p-small-t">{{track.name}}</li>
								<li class="p-small-t">{{track.album.name}}</li>
								<li class="p-small-t">{{track.artist.name}}</li>
							</ul>
						</div>
					</div>
				{% endfor %}
				{% else %}
					<p>No other tracks are available.</p>	
				{% endif %}
			</div>
		</div>
		<script type="text/javascript">
		$(document).ready(function() {
	    	$("#playlist-flipbox").bind("click", function() {
	    		$("#playlist-flipbox").flip({
	    			direction: 'rl',
	    			onBefore: function() {
	    				$("#playlist-flipbox-data").hide();
	    			},
	    			onAnimation: function() {
	    				// Make API call and update div.
	    				$.get("http://localhost:11080/backend/getFormattedLibrary/?location_id=2&device_id=1234", function(data) {
	    					$("#library-flipbox-data").html(data);
	    				});
	    			},
	    			onEnd: function() {
	    				$("#library-flipbox-data").show();
	    			}
	    		});
	    	});
	    	
	    	$("#library-flipbox").bind("click", function() {
	    		$("#library-flipbox").flip({
	    			direction: 'rl',
	    			onBefore: function() {
	    				$("#library-flipbox-data").hide();
	    			},
	    			onAnimation: function() {
	    				// Make API call and update div.
	    				$.get("http://localhost:11080/backend/refreshPlaylistFormatted/?device_id=1&location_id=1", function(data) {
	    					$("#playlist-flipbox-data").html(data);
	    				});
	    			},
	    			onEnd: function() {
	    				$("#playlist-flipbox-data").show();
	    			}
	    		});
	    	});
	    	
	    	var player = $("#player");
	    	player.src="donomar.m4a";
	    	player.bind("ended", function() {
	    		$.get("http://api.soundit.ca/backend/venue/getNextSong/", function(data) {
	    			if(data.toLowerCase == "beautiful day") {
	    				player.src="u2.m4a";
	    			} else if (data.toLowerCase == "danza kuduro") {
	    				player.src="donomar.m4a";
    				} else if (data.toLowerCase == "we found love") {
	    				player.src="rihanna.m4a";
	    			} else if (data.toLowerCase == "gangnam style") {
	    				player.src="psy.m4a";
    				} else if (data.toLowerCase == "party in the usa") {
	    				player.src="miley-cyrus.m4a";
	    			} else if (data.toLowerCase == "moves like jagger") {
	    				player.src="maroon5.m4a";
	    			} else if (data.toLowerCase == "hotel california") {
	    				player.src="eagles.m4a";
	    			} else if (data.toLowerCase == "livin on a prayer") {
	    				player.src="bonjovi.m4a";
	    			} else if (data.toLowerCase == "billie jean") {
	    				player.src="billie-jean.m4a";
    				} else if (data.toLowerCase == "skyfall") {
	    				player.src="adele.m4a";
    				}
    				if (data != false) {
    					audio.play();
    				}
	    		});
	    	});
    	});
    	</script>
	</div>
{% endblock %}